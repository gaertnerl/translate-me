FROM python:3.10

ARG API_HOST
ARG API_PORT
ARG LOADBALANCER_REGISTER_URL
ARG LOADBALANCER_API_KEY

ENV API_HOST=${API_HOST}
ENV API_PORT=${API_PORT}
ENV LOADBALANCER_API_KEY=${LOADBALANCER_API_KEY}
ENV LOADBALANCER_REGISTER_URL=${LOADBALANCER_REGISTER_URL}

WORKDIR /api

COPY ./requirements.txt /api

RUN pip install --no-cache-dir --upgrade -r /api/requirements.txt

COPY ./src /api/src

WORKDIR /api/src

EXPOSE ${API_PORT}

CMD uvicorn api:app --host ${API_HOST} --port ${API_PORT}